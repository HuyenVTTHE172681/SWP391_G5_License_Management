<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Admin • Account detail</title>
    <style>
        :root{--bg:#f5f7fb;--card:#fff;--muted:#64748b;--text:#0f172a;--border:#e2e8f0;
            --btn-h:38px;--radius:12px;--shadow:0 10px 24px rgba(2,6,23,.08)}
        *{box-sizing:border-box}
        body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
            background:radial-gradient(1200px 600px at 20% -10%, #c7d2fe33, transparent 60%),
            radial-gradient(1000px 500px at 110% 10%, #bbf7d033, transparent 60%), var(--bg);
            color:var(--text);padding:28px}
        .wrap{max-width:1000px;margin:0 auto}
        .breadcrumb{margin:0 0 12px}.breadcrumb a{color:#334155;text-decoration:none}
        .breadcrumb a:hover{text-decoration:underline}
        .page-head{display:flex;justify-content:space-between;align-items:flex-end;gap:16px;margin-bottom:18px}
        .title{margin:0;font-weight:800;letter-spacing:.2px;line-height:1.1;font-size:clamp(24px,3vw,30px)}
        .subtitle{margin:6px 0 0;color:var(--muted);font-size:13px}
        .page-actions{display:flex;align-items:center;gap:8px}
        .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
        @media (max-width:860px){.grid{grid-template-columns:1fr}}

        .card{background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid var(--border);
            border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
        .card-head{padding:14px 16px;border-bottom:1px solid var(--border)}
        .card-title{margin:0;font-weight:700;font-size:15px}
        .card-body{padding:16px}

        .dl{display:grid;grid-template-columns:160px 1fr;gap:10px 14px}
        .dl dt{font-weight:700;color:#0b1220}.dl dd{margin:0 0 8px 0}
        .muted{color:var(--muted)} .mono{font-family:ui-monospace,Menlo,Consolas,monospace}

        .badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid #c7d2fe;background:#eef2ff;color:#1e3a8a}
        .badge.status-active{background:#ecfdf5;color:#166534;border-color:#86efac}
        .badge.status-deactivated{background:#fee2e2;color:#991b1b;border-color:#fecaca}
        .badge.verify{background:#e0f2fe;border-color:#bae6fd;color:#075985}

        /* controls */
        select, input, button{font:inherit}
        select, .input{height:var(--btn-h);padding:0 12px;border:1px solid var(--border);border-radius:12px;background:#fff;color:var(--text)}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;height:var(--btn-h);
            padding:0 14px;border:1px solid var(--border);border-radius:12px;background:#fff;color:var(--text);
            cursor:pointer;text-decoration:none;line-height:1;transition:transform .06s ease,background .15s ease}
        .btn:hover{background:#eef2ff;transform:translateY(-1px)} .btn:active{transform:translateY(0)}
        .btn.primary{border-color:#bfdbfe;background:#eff6ff;color:#1e40af}
        .btn.success{border-color:#86efac;background:#ecfdf5;color:#166534}
        .btn.danger{border-color:#fecaca;background:#fff1f2;color:#9f1239}
        .btn.ghost{border-color:var(--border);background:#fff}
        .btn.block{display:flex;width:100%}
        .form-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
        .actions-list{display:grid;gap:10px}.actions-list .btn{width:100%}

        /* error styles like your register page */
        .field{margin:8px 0}
        .label{font-weight:700;margin-bottom:6px;display:block}
        .input.invalid{border-color:#ef4444;background:#fff7f7}
        .error-text{color:#ef4444;font-size:13px;margin:6px 0 0 0}
        .flash{padding:10px 12px;margin:10px 0;border:1px solid #bfdbfe;background:#eff6ff;color:#1e3a8a;border-radius:10px;font-size:13px}
    </style>
</head>
<body>
<div class="wrap"
     th:with="isActive=${acc.status != null and acc.status.name() == 'ACTIVE'},
              isFixed=${#strings.equalsIgnoreCase(acc.email, fixedAdminEmail)}">

    <p class="breadcrumb">
        <a th:href="@{/admin/accounts(q=${q}, status=${status}, page=${page}, size=${size}, sort=${sort})}">← Back to list</a>
    </p>

    <div th:if="${msg != null and !#strings.isEmpty(#strings.trim(msg))}" class="flash" th:text="${msg}"></div>

    <div class="page-head">
        <div>
            <h1 class="title">Account detail</h1>
            <p class="subtitle">Thông tin người dùng &amp; thao tác quản trị.</p>
        </div>

        <div class="page-actions">
            <a class="btn ghost" th:if="${!edit}"
               th:href="@{/admin/accounts/{id}(id=${acc.accountId}, edit=1, q=${q}, status=${status}, page=${page}, size=${size}, sort=${sort})}">
                Edit info
            </a>
            <a class="btn ghost" th:if="${edit}"
               th:href="@{/admin/accounts/{id}(id=${acc.accountId}, q=${q}, status=${status}, page=${page}, size=${size}, sort=${sort})}">
                Cancel
            </a>
        </div>
    </div>

    <div class="grid">

        <!-- LEFT -->
        <section class="card">
            <div class="card-head">
                <h3 class="card-title" th:text="${edit} ? 'Chỉnh sửa thông tin' : 'Thông tin tài khoản'"></h3>
            </div>

            <!-- VIEW -->
            <div class="card-body" th:if="${!edit}">
                <dl class="dl">
                    <dt>ID</dt><dd class="mono" th:text="${acc.accountId}">1</dd>
                    <dt>Email</dt><dd class="mono" th:text="${acc.email}">email@example.com</dd>
                    <dt>Full name</dt><dd th:text="${acc.fullName} ?: '—'">Name</dd>
                    <dt>Phone</dt><dd th:text="${#strings.isEmpty(acc.phone) ? '—' : acc.phone}">—</dd>
                    <dt>Address</dt><dd th:text="${#strings.isEmpty(acc.address) ? '—' : acc.address}">—</dd>
                    <dt>Role</dt>
                    <dd>
                        <span th:if="${acc.role != null}" class="badge" th:text="${acc.role.roleName}">ROLE</span>
                        <span th:if="${acc.role == null}" class="muted">N/A</span>
                    </dd>
                    <dt>Status</dt>
                    <dd>
            <span th:class="'badge ' + (${isActive} ? 'status-active' : 'status-deactivated')"
                  th:text="${acc.status != null ? acc.status.name() : 'N/A'}">ACTIVE</span>
                    </dd>
                    <dt>Verified</dt>
                    <dd>
                        <span th:if="${acc.verified}" class="badge verify">Verified</span>
                        <span th:if="${!acc.verified}" class="muted">Not verified</span>
                    </dd>
                    <dt>Created</dt>
                    <dd th:text="${acc.createdAt != null ? #temporals.format(acc.createdAt,'dd/MM/yyyy HH:mm') : '—'}">—</dd>
                    <dt>Updated</dt>
                    <dd th:text="${acc.updatedAt != null ? #temporals.format(acc.updatedAt,'dd/MM/yyyy HH:mm') : '—'}">—</dd>
                </dl>
            </div>

            <!-- EDIT -->
            <div class="card-body" th:if="${edit}">
                <form th:action="@{/admin/accounts/{id}/update(id=${acc.accountId})}"
                      th:object="${acc}" method="post">
                    <div th:if="${_csrf != null}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    </div>

                    <!-- Giữ state -->
                    <input type="hidden" name="q"     th:value="${q}"/>
                    <input type="hidden" name="status" th:value="${status}"/>
                    <input type="hidden" name="page"   th:value="${page}"/>
                    <input type="hidden" name="size"   th:value="${size}"/>
                    <input type="hidden" name="sort"   th:value="${sort}"/>

                    <!-- (tùy) giữ email/password nếu model yêu cầu không-null -->
                    <input type="hidden" th:field="*{email}"/>
                    <input type="hidden" th:field="*{password}"/>

                    <!-- Banner lỗi chung -->
                    <div class="flash" th:if="${#fields.hasAnyErrors()}">
                        Vui lòng sửa các lỗi bên dưới và thử lại.
                    </div>

                    <!-- Full name -->
                    <div class="field">
                        <label class="label">* Họ và tên</label>
                        <input class="input" type="text" th:field="*{fullName}"
                               th:classappend="${#fields.hasErrors('fullName')} ? ' invalid'">
                        <p class="error-text" th:if="${#fields.hasErrors('fullName')}"
                           th:errors="*{fullName}"></p>
                    </div>

                    <!-- Phone -->
                    <div class="field">
                        <label class="label">* Số điện thoại</label>
                        <input class="input" type="text" th:field="*{phone}"
                               th:classappend="${#fields.hasErrors('phone')} ? ' invalid'">
                        <p class="error-text" th:if="${#fields.hasErrors('phone')}"
                           th:errors="*{phone}"></p>
                        <p class="muted">Số điện thoại phải có 9 chữ số và bắt đầu bằng 0.</p>
                    </div>

                    <!-- Address -->
                    <div class="field">
                        <label class="label">Địa chỉ</label>
                        <input class="input" type="text" th:field="*{address}">
                        <p class="error-text" th:if="${#fields.hasErrors('address')}"
                           th:errors="*{address}"></p>
                    </div>

                    <button class="btn success" type="submit">Save</button>
                    <a class="btn ghost"
                       th:href="@{/admin/accounts/{id}(id=${acc.accountId}, q=${q}, status=${status}, page=${page}, size=${size}, sort=${sort})}">
                        Cancel
                    </a>
                </form>
            </div>
        </section>

        <!-- RIGHT -->
        <aside class="card">
            <div class="card-head"><h3 class="card-title">Thao tác</h3></div>
            <div class="card-body">
                <div th:if="${roles != null}">
                    <p class="muted" style="margin:0 0 6px">Đổi vai trò</p>
                    <form class="form-row" th:action="@{/admin/accounts/{id}/role(id=${acc.accountId})}" method="post">
                        <div th:if="${_csrf != null}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        </div>
                        <input type="hidden" name="return" value="detail"/>
                        <input type="hidden" name="q" th:value="${q}"/>
                        <input type="hidden" name="status" th:value="${status}"/>
                        <input type="hidden" name="page" th:value="${page}"/>
                        <input type="hidden" name="size" th:value="${size}"/>
                        <input type="hidden" name="sort" th:value="${sort}"/>

                        <select name="role" required th:disabled="${isFixed}">
                            <option th:each="r : ${roles}" th:value="${r}" th:text="${r}"
                                    th:selected="${acc.role != null and acc.role.roleName == r}"
                                    th:attr="disabled=${r.name() == 'ADMIN' and !isFixed}">
                            </option>
                        </select>
                        <button class="btn success" type="submit" th:disabled="${isFixed}">Update</button>
                    </form>
                    <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
                </div>

                <div class="actions-list">
                    <a class="btn primary"
                       th:href="@{/admin/accounts/{id}(id=${acc.accountId}, q=${q}, status=${status}, page=${page}, size=${size}, sort=${sort})}">
                        Refresh
                    </a>

                    <form th:if="${isActive}" th:action="@{/admin/accounts/{id}/delete(id=${acc.accountId})}" method="post"
                          onsubmit="return confirm('Deactivate this account?');">
                        <div th:if="${_csrf != null}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        </div>
                        <input type="hidden" name="return" value="detail"/>
                        <input type="hidden" name="q" th:value="${q}"/>
                        <input type="hidden" name="status" th:value="${status}"/>
                        <input type="hidden" name="page" th:value="${page}"/>
                        <input type="hidden" name="size" th:value="${size}"/>
                        <input type="hidden" name="sort" th:value="${sort}"/>
                        <button class="btn danger" type="submit" th:disabled="${isFixed}">Deactivate account</button>
                    </form>

                    <form th:if="${!isActive}" th:action="@{/admin/accounts/{id}/reactivate(id=${acc.accountId})}" method="post"
                          onsubmit="return confirm('Reactivate this account?');">
                        <div th:if="${_csrf != null}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        </div>
                        <input type="hidden" name="return" value="detail"/>
                        <input type="hidden" name="q" th:value="${q}"/>
                        <input type="hidden" name="status" th:value="${status}"/>
                        <input type="hidden" name="page" th:value="${page}"/>
                        <input type="hidden" name="size" th:value="${size}"/>
                        <input type="hidden" name="sort" th:value="${sort}"/>
                        <button class="btn success" type="submit" th:disabled="${isFixed}">Reactivate account</button>
                    </form>
                </div>

                <p class="muted" th:if="${isFixed}">
                    Không thể vô hiệu hoá tài khoản ADMIN cố định.
                </p>
            </div>
        </aside>
    </div>
</div>
</body>
</html>
