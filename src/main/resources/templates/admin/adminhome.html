<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Admin • Home</title>

    <!-- CSS cần dùng -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/home.css}" rel="stylesheet">
    <link th:href="@{/css/admin-home.css}" rel="stylesheet">
</head>
<body>

<!-- Header mini riêng cho Admin -->
<div class="sticky-top bg-white border-bottom">
    <div class="container-fluid py-2 d-flex justify-content-between align-items-center">
        <!-- Brand -->
        <a class="navbar-brand fw-semibold d-flex align-items-center gap-2" th:href="@{/admin/adminhome}">
            <i class="bi bi-speedometer2"></i>
            <span>Admin</span>
        </a>

        <!-- Actions -->
        <div class="d-flex align-items-center gap-2">
            <a class="btn btn-outline-dark btn-sm" th:href="@{/profile}">
                <i class="bi bi-person-circle me-1"></i> View Profile
            </a>

            <!-- Logout (POST + CSRF) -->
            <a href="/logout" class="nav-link text-danger">Logout</a>
        </div>
    </div>
</div>

<main class="admin-content">
    <div class="wrap">

        <!-- Page head -->
        <div class="page-head">
            <div>
                <h1 class="title">Admin Home</h1>
                <p class="subtitle">Tổng quan &amp; hoạt động gần đây</p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <a class="tab" th:classappend="${page}=='home' ? 'active'" th:href="@{/admin/adminhome}">Home</a>
            <a class="tab" th:classappend="${page}=='accounts' ? 'active'" th:href="@{/admin/accounts}">Accounts</a>
        </div>

        <!-- Flash message -->
        <p th:if="${msg != null and !#strings.isEmpty(#strings.trim(msg))}"
           class="flash" th:text="${msg}" id="flash">Message</p>

        <!-- KPIs -->
        <div class="kpis">
            <div class="kpi">
                <div class="label">Total Users</div>
                <div class="value" th:text="${#numbers.formatInteger(totalUsers,0)}">0</div>
            </div>
            <div class="kpi">
                <div class="label">Total Sellers</div>
                <div class="value" th:text="${#numbers.formatInteger(totalSellers,0)}">0</div>
            </div>
            <div class="kpi">
                <div class="label">Total Customers</div>
                <div class="value" th:text="${#numbers.formatInteger(totalCustomers,0)}">0</div>
            </div>
        </div>

        <!-- ========== Section: Latest registrations (TOP) ========== -->
        <div class="section">
            <div class="card">
                <div class="card-head">
                    <h3 class="card-title">User đăng ký mới nhất</h3>

                    <!-- Bộ lọc (đồng bộ tên tham số với Accounts: q/sort/size) -->
                    <form class="filters" th:action="@{/admin/adminhome}" method="get">
                        <input type="text" name="q1" placeholder="Search email or name…" th:value="${q1}"/>

                        <select name="sort1">
                            <option value="accountId,asc"  th:selected="${sort1}=='accountId,asc'">ID ↑</option>
                            <option value="accountId,desc" th:selected="${sort1}=='accountId,desc'">ID ↓</option>
                            <option value="email,asc"      th:selected="${sort1}=='email,asc'">Email A–Z</option>
                            <option value="email,desc"     th:selected="${sort1}=='email,desc'">Email Z–A</option>
                            <option value="fullName,asc"   th:selected="${sort1}=='fullName,asc'">Name A–Z</option>
                            <option value="fullName,desc"  th:selected="${sort1}=='fullName,desc'">Name Z–A</option>
                            <option value="createdAt,desc" th:selected="${sort1}=='createdAt,desc'">Newest</option>
                            <option value="createdAt,asc"  th:selected="${sort1}=='createdAt,asc'">Oldest</option>
                        </select>

                        <select name="s1">
                            <option th:value="5"  th:selected="${s1}==5">5 / page</option>
                            <option th:value="10" th:selected="${s1}==10">10 / page</option>
                            <option th:value="20" th:selected="${s1}==20">20 / page</option>
                            <option th:value="50" th:selected="${s1}==50">50 / page</option>
                        </select>

                        <button class="btn update" type="submit">Apply</button>
                        <a class="btn" th:href="@{/admin/adminhome}">Reset</a>
                        <a class="btn" th:href="@{/admin/accounts(q=${q1},sort=${sort1},size=${s1})}">Xem tất cả</a>
                    </form>
                </div>

                <!-- Empty -->
                <div th:if="${accLatestPage == null or accLatestPage.totalElements == 0}" class="empty">Chưa có dữ liệu</div>

                <!-- List -->
                <div class="table-wrap" th:if="${accLatestPage != null and accLatestPage.totalElements > 0}">
                    <table>
                        <thead>
                        <tr>
                            <th style="width:90px">ID</th>
                            <th>Email</th>
                            <th>Full name</th>
                            <th style="width:140px">Role</th>
                            <th style="width:170px">Created At</th>
                            <th style="width:140px">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="a : ${accLatestPage.content}">
                            <td class="small" th:text="${a.accountId}">1</td>
                            <td th:text="${a.email}">email@example.com</td>
                            <td th:text="${a.fullName}">Name</td>
                            <td>
                                <span th:if="${a.role != null}" class="badge" th:text="${a.role.roleName}">ROLE</span>
                                <span th:if="${a.role == null}" class="badge">N/A</span>
                            </td>
                            <td class="small"
                                th:text="${a.createdAt != null ? #temporals.format(a.createdAt, 'yyyy-MM-dd HH:mm') : '-'}">-</td>
                            <td>
                                <a class="btn view" th:href="@{|/admin/accounts/${a.accountId}|}">View</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination  -->
                <div class="pager" th:if="${accLatestPage != null and accLatestPage.totalPages > 0}">
                    <div class="subtitle">
                        Page [[${accLatestPage.number + 1}]] / [[${accLatestPage.totalPages}]] • Total [[${accLatestPage.totalElements}]]
                    </div>

                    <ul class="pagination">
                        <li th:classappend="${accLatestPage.first} ? 'disabled'">
                            <a th:if="${!accLatestPage.first}"
                               th:href="@{/admin/adminhome(q1=${q1}, sort1=${sort1}, s1=${s1}, p1=${accLatestPage.number - 1})}">&laquo; Prev</a>
                            <span th:if="${accLatestPage.first}">&laquo; Prev</span>
                        </li>

                        <li th:classappend="${accLatestPage.last} ? 'disabled'">
                            <a th:if="${!accLatestPage.last}"
                               th:href="@{/admin/adminhome(q1=${q1}, sort1=${sort1}, s1=${s1}, p1=${accLatestPage.number + 1})}">Next &raquo;</a>
                            <span th:if="${accLatestPage.last}">Next &raquo;</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</main>

<!-- Bootstrap JS để dropdown trong header hoạt động -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
</body>
</html>
