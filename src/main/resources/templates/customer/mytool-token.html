<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>T√†i kho·∫£n d·ªãch v·ª• (TOKEN)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4" th:object="${acc}">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h4 class="mb-0">üß∞ Tool: <span th:text="${tool.toolName}">Tool</span></h4>
            <small class="text-muted">
                Ph∆∞∆°ng th·ª©c: <span th:text="*{loginMethod}">TOKEN</span> ¬∑
                M√£ ƒë∆°n: <span th:text="${order.orderId}">0</span>
            </small>
        </div>

    </div>

    <div th:if="${ok}" class="alert alert-success" th:text="${ok}"></div>
    <div th:if="${err}" class="alert alert-danger" th:text="${err}"></div>

    <!-- Th√¥ng tin t√†i kho·∫£n -->
    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <tbody>
            <tr>
                <th style="width:260px">License Account ID</th>
                <td th:text="*{licenseAccountId}">-</td>
            </tr>

            <tr>
                <th>Login method</th>
                <td th:text="*{loginMethod}">TOKEN</td>
            </tr>

            <tr>
                <th>Token</th>
                <td class="d-flex align-items-center gap-2">
                    <code id="tVal" th:text="*{token != null ? token : '‚Äî'}">TOKEN_VALUE</code>
                    <button class="btn btn-sm btn-outline-secondary" type="button" onclick="toggleToken()">Hi·ªán/·∫®n</button>
                    <button class="btn btn-sm btn-outline-primary" type="button" onclick="copyText('tVal')">Copy</button>
                </td>
            </tr>

            <tr>
                <th>Status</th>
                <td th:switch="${acc.status != null ? acc.status.name() : null}">
                    <span class="badge text-bg-success"  th:case="'ACTIVE'">ACTIVE</span>
                    <span class="badge text-bg-secondary" th:case="'EXPIRED'">EXPIRED</span>
                    <span class="badge text-bg-danger"   th:case="'REVOKED'">REVOKED</span>
                    <span class="badge text-bg-secondary" th:case="*">N/A</span>
                </td>
            </tr>

            <tr>
                <th>Hi·ªáu l·ª±c</th>
                <td>
                    <span th:text="${acc.startDate != null ? #temporals.format(acc.startDate,'dd/MM/yyyy HH:mm') : '-'}">-</span>
                    ‚Üí
                    <span th:text="${acc.endDate != null ? #temporals.format(acc.endDate,'dd/MM/yyyy HH:mm') : '-'}">-</span>
                </td>
            </tr>

            <tr>
                <th>L·∫ßn ƒëƒÉng nh·∫≠p g·∫ßn nh·∫•t</th>
                <td th:text="${acc.lastLogin != null ? #temporals.format(acc.lastLogin,'dd/MM/yyyy HH:mm') : '-'}">-</td>
            </tr>

            <tr><th>Thi·∫øt b·ªã</th><td th:text="${#strings.isEmpty(acc.deviceInfo) ? '-' : acc.deviceInfo}">-</td></tr>
            <tr><th>Max devices</th><td th:text="*{maxDevices}">1</td></tr>

            <tr>
                <th>ƒê√£ k√≠ch ho·∫°t</th>
                <td>
                    <span th:text="*{used} ? 'Yes' : 'No'">No</span>
                    <span th:if="*{activatedAt != null}">
                        ¬∑ <span th:text="${#temporals.format(acc.activatedAt,'dd/MM/yyyy HH:mm')}">-</span>
                    </span>
                </td>
            </tr>

            <tr>
                <th>License g√≥i (l·∫ßn mua g·∫ßn nh·∫•t)</th>
                <td th:text="${order.license != null ? order.license.name : '-'}">-</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- File c√†i ƒë·∫∑t / ƒë√≠nh k√®m -->
    <div class="card mt-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <strong>T·ªáp c√†i ƒë·∫∑t / file ƒë√≠nh k√®m</strong>
            <small class="text-muted">C√°c file thu·ªôc Tool n√†y</small>
        </div>
        <div class="card-body p-0">
            <table class="table mb-0 align-middle">
                <thead>
                <tr>
                    <th style="width:40%">T√™n file</th>
                    <th style="width:15%">Lo·∫°i</th>
                    <th style="width:25%">Ng√†y t·∫£i l√™n</th>
                    <th style="width:20%"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(files)}">
                    <td colspan="4" class="text-center text-muted">Ch∆∞a c√≥ file n√†o</td>
                </tr>

                <tr th:each="f : ${files}"
                    th:with="p=${f.filePath != null ? #strings.replace(f.filePath,'\\','/') : ''}">
                    <!-- L·∫•y t√™n file an to√†n cho c·∫£ Windows/Unix -->
                    <td th:text="${p != '' ? p.substring(p.lastIndexOf('/') + 1) : '-'}">file.zip</td>

                    <td th:switch="${f.fileType != null ? f.fileType.name() : null}">
                        <span class="badge bg-secondary" th:case="'ORIGINAL'">ORIGINAL</span>
                        <span class="badge bg-info"      th:case="'WRAPPED'">WRAPPED</span>
                        <span class="badge bg-secondary" th:case="*">N/A</span>
                    </td>

                    <td th:text="${f.createdAt != null ? #temporals.format(f.createdAt,'dd/MM/yyyy HH:mm') : '-'}">-</td>
                    <td class="text-end">
                        <a class="btn btn-sm btn-outline-primary"
                           th:href="@{|/my-tools/${order.orderId}/files/${f.fileId}|}">Download</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <a href="/orders" class="btn btn-link mt-3">¬´ Quay l·∫°i ƒë∆°n h√†ng</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // ·∫®n/Hi·ªán token
    document.addEventListener('DOMContentLoaded', function(){
        const el = document.getElementById('tVal');
        if (el && !el.dataset.orig) el.dataset.orig = el.textContent;
        if (el) el.dataset.real = '1';
    });

    function toggleToken(){
        const el = document.getElementById('tVal');
        if (!el) return;
        if (el.dataset.real === '1') {
            el.textContent = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            el.dataset.real = '0';
        } else {
            el.textContent = el.dataset.orig || '';
            el.dataset.real = '1';
        }
    }

    function copyText(id){
        const t = document.getElementById(id)?.innerText || '';
        navigator.clipboard.writeText(t).then(()=>alert('ƒê√£ copy'));
    }
</script>
</body>
</html>
