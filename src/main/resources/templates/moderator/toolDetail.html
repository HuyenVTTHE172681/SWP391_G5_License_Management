<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tool Detail - Moderator</title>
    <link rel="stylesheet" th:href="@{/css/manager-tool-detail.css}">
</head>
<body>

<div class="page">
    <div class="tool-card">
        <!-- LEFT: image -->
        <div class="tool-image">
<!--            <img th:src="@{'/upload/' + ${tool.image}}" alt="Tool Image">-->
            <img id="imgPreview"
                 class="preview-img"
                 th:if="${tool.image != null}"
                 th:src="@{'/' + ${tool.image}}"
                 alt="Current tool image">
        </div>

        <!-- RIGHT: header + info -->
        <div class="tool-info">
            <h1 class="title-pill" th:text="${tool.toolName} + ' - ' + ${tool.toolId}">Tool Name - ID</h1>

            <p class="desc" th:text="${tool.description}">description</p>

            <!-- license chips -->
            <ul class="license-chips">
                <li th:each="l : ${tool.licenses}" th:text="${l.name} + ' - ' + ${l.price}">License - price</li>
            </ul>

            <!-- meta 2 columns -->
            <div class="meta-grid">
                <div class="meta-row">
                    <span class="meta-label">Category:</span>
                    <span class="meta-value" th:text="${tool.category != null ? tool.category.categoryName : 'N/A'}"></span>
                </div>
                <div class="meta-row">
                    <span class="meta-label">Status:</span>
                    <span class="badge" th:classappend="${tool.status}" th:text="${tool.status}"></span>
                </div>

                <div class="meta-row">
                    <span class="meta-label">Seller:</span>
                    <span class="meta-value" th:text="${tool.seller != null ? tool.seller.fullName : 'N/A'} "></span>
                    <span class="meta-label">Account ID:</span>
                    <span class="meta-value" th:text="${tool.seller != null ? tool.seller.getAccountId() : '00'} "></span>

                </div>
                <div class="meta-row">
                    <span class="meta-label">Reviewed By:</span>
                    <span class="meta-value" th:text="${tool.reviewedBy != null ? tool.reviewedBy.toString() : '—'}"></span>
                </div>

                <div class="meta-row">
                    <span class="meta-label">Login method:</span>
                    <span class="meta-value" th:text="${tool.loginMethod}"></span>
                </div>
                <div class="meta-row">
                    <span class="meta-label">Note:</span>
                    <span class="meta-value" th:text="${tool.note != null ? tool.note : 'none'}"></span>
                </div>

                <div class="meta-row">
                    <span class="meta-label">Upload Date:</span>
                    <span class="meta-value" th:text="${#temporals.format(tool.createdAt, 'dd-MM-yyyy HH:mm')}"></span>
                </div>
            </div>

            <!-- actions (centered) -->
            <div class="action-buttons" th:if="${tool.status.name() == 'PENDING'}">
                <form th:action="@{'/moderator/tool/' + ${tool.toolId} + '/approve'}" method="post">
                    <button type="submit" class="btn-approve big-pill">Approve</button>
                </form>
                <button type="button" class="btn-reject big-pill" onclick="toggleReject()">Reject</button>
            </div>

            <!-- reject reason bubble -->
            <form id="rejectForm"
                  th:action="@{'/moderator/tool/' + ${tool.toolId} + '/reject'}"
                  method="post"
                  class="reject-form hidden">
                <label class="reject-title">Reason:</label>
                <input type="text" name="reason" placeholder="Reason..." required>
                <div class="reject-actions">
                    <button type="submit" class="btn-confirm">Submit</button>
                    <button type="button" class="btn-cancel" onclick="toggleReject()">Cancel</button>
                </div>
            </form>
        </div>

        <!-- FILES/TOKENS: box at bottom-left -->
        <section class="files-section">
            <h3>Tool Files:</h3>

            <ul class="file-list" th:if="${tool.files != null and !#lists.isEmpty(tool.files)}">
                <li th:each="file : ${tool.files}">
                    <a th:href="@{${file.filePath}}" th:download="${file.filePath}" target="_blank">
                        <span th:text="${file.filePath}">tool-file.ext</span>
                    </a>
                    <span class="file-type" th:text="'(' + ${file.fileType} + ')'">(type)</span>
                </li>

                <!-- TOKEN grid (only when loginMethod == TOKEN) -->
                <li class="token-block"
                    th:if="${tool.loginMethod?.name() == 'TOKEN' and licenseAccounts != null and !#lists.isEmpty(licenseAccounts)}">
                    <p class="token-title">Token: (if login method == token)</p>
                    <div class="token-grid">
                        <span th:each="l : ${licenseAccounts}"
                              th:text="${l.token != null ? '*****' + #strings.substring(l.token, l.token.length() - 4) : 'No token'}"></span>
                    </div>
                </li>
            </ul>

            <p th:if="${tool.files == null or #lists.isEmpty(tool.files)}" class="no-file">
                No file appended
            </p>
        </section>

        <!-- back links -->
        <a th:if="${tool.status.name() == 'PENDING'}"
           th:href="@{/moderator/uploadRequest}"
           class="back-link">← Back</a>

        <a th:unless="${tool.status.name() == 'PENDING'}"
           th:href="@{/moderator/history}"
           class="back-link">← Back</a>
    </div>
</div>

<script>
    function toggleReject() {
        document.getElementById('rejectForm').classList.toggle('hidden');
    }
</script>

</body>
</html>
